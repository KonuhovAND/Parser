import re
from nameparser import HumanName

TEAMS = [
    "Авангард", "Омск",
    "Автомобилист", "Екатеринбург", 
    "Адмирал", "Владивосток",
    "Ак Барс", "Казань",
    "Амур", "Хабаровск",
    "Барыс", "Астана",
    "Динамо М", "Москва",
    "Динамо Мн", "Минск",
    "Лада", "Тольятти",
    "Локомотив", "Ярославль",
    "Металлург Мг", "Магнитогорск",
    "Нефтехимик", "Нижнекамск",
    "СКА", "Санкт-Петербург",
    "Салават Юлаев", "Уфа",
    "Северсталь", "Череповец",
    "Сибирь", "Новосибирская область",
    "Спартак", "Москва",
    "Торпедо", "Нижний Новгород",
    "Трактор", "Челябинск",
    "ХК Сочи", "Сочи",
    "ЦСКА", "Москва",
    "Шанхайские Драконы", "Шанхай",
    "Южный Урал","Омские Крылья",
    
    # Добавленные команды из ваших данных
    "Торпедо-Горький", "АКМ", "Ростов", "Динамо СПб", "Химик", "Рязань-ВДВ",
    "Стальные Лисы", "Чайка", "Толпар", "Ирбис", "Лозанна", "Ингольштадт",
    "Берн", "Комета Брно", "Цуг", "Белфаст Джайантс", "Больцано", "Маунтфилд",
    "Фиштаун Пингвинз", "Лукко", "Айсберен Берлин", "Гренобль", "Металлург Нк",
    "Дизель", "Горняк-УГМК", "Югра", "Магнитка", "Молот", "Челмет", "Нефтяник",
    "Торос", "Звезда", "Зауралье", "Ижсталь", "Сокол", "Барс", "Олимпия",
    "ЦСК ВВС", "Рубин", "ХК Тамбов", "ХК Норильск", "Динамо-Алтай", "СКА-ВМФ",
    "Кристалл", "Буран", "Челны", "Красная Армия", "Локо", "МХК Динамо М",
    "МХК Спартак", "Динамо-Шинник", "МХК Динамо СПб", "Алмаз", "Академия Михайлова",
    "Оденсе Бульдогс", "Клагенфуртер", "ГКС Тыхы", "Лулео", "Брюнес", "Цюрих Лайонс",
    "Ильвес", "Сторхамар"
]

def is_valid_player(name):
    """
    Простая проверка имени с эвристическими правилами
    """
    try:
        name = name.strip()
        
        # Базовые проверки (более мягкие)
        if not name or len(name) < 3 or len(name) > 50:
            return False
        
        # Не должно содержать цифр
        if any(char.isdigit() for char in name):
            return False
        
        # Не должно содержать специальных символов (кроме пробелов, дефисов, точек)
        if re.search(r'[!@#$%^&*()_+=\[\]{};:"\\|,<>/?]', name):
            return False
        
        # Должно содержать пробел (имя и фамилия) - но это не всегда обязательно
        if ' ' not in name:
            # Разрешаем имена без пробелов (например, иностранные имена)
            words = [name]
        else:
            words = name.split()
        
        if len(words) < 1 or len(words) > 4:
            return False
        
        # Проверяем каждое слово (более мягкие требования)
        for word in words:
            if len(word) < 1:  # Разрешаем очень короткие слова
                return False
            if len(word) > 20:  # Увеличил максимальную длину слова
                return False
        
        # Черный список общих не-имен (расширенный)
        blacklist = [
            'комета', 'цюрих', 'бельфаст', 'айсберен', 'оденсе', 'фиштаун',
            'академия', 'красная', 'армия', 'стальные', 'лисы', 'львы',
            'пингвины', 'медведи', 'собаки', 'тигры', 'волки', 'орлы',
            'окончен', 'завершен', 'матч', 'игра', 'тайм', 'период',
            'нк','спб','крылья', 'россия', 'канада', 'сша', 'германия', 'вр', 'зщ', 'нп',
            'торпедо', 'горький', 'акм', 'ростов', 'динамо', 'химик', 'рязань', 'вдв',
            'металлург', 'дизель', 'горняк', 'югра', 'магнитка', 'молот', 'челмет',
            'нефтяник', 'торос', 'звезда', 'зауралье', 'ижсталь', 'сокол', 'барс',
            'олимпия', 'цск', 'ввс', 'рубин', 'тамбов', 'норильск', 'алтай', 'вмф',
            'кристалл', 'буран', 'челны', 'ирбис', 'толпар', 'лозанна', 'ингольштадт',
            'берн', 'комета', 'брно', 'цуг', 'бельфаст', 'джайантс', 'больцано', 'маунтфилд',
            'фиштаун', 'пингвинз', 'лукко', 'айсберен', 'берлин', 'гренобль'
        ]
        
        lower_name = name.lower()
        for banned in blacklist:
            if banned in lower_name:
                return False
        
        # Дополнительная проверка: имя не должно совпадать с названием команды из TEAMS
        if name in TEAMS:
            return False
        
        # Проверка на аббревиатуры и короткие названия
        if len(name) <= 4 and name.isupper():
            return False
            
        # Если все проверки пройдены
        return True
        
    except Exception as e:
        print(f"Ошибка при простой проверке имени '{name}': {e}")
        return False